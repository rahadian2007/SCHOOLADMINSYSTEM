<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CRUD ID Warga - React CDN</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  input, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  tr:nth-child(even) { background: #f9f9f9; }
  button { cursor: pointer; }
  .btn-edit { color: blue; }
  .btn-delete { color: red; }
</style>
</head>
<body>

<h1>CRUD ID Warga (React CDN)</h1>
<div id="root"></div>

<!-- React & ReactDOM CDN -->
<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
<!-- Babel CDN untuk JSX -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">

const { useState, useEffect } = React;
const API_URL = 'http://139.59.224.22/api/ID-warga';

function App() {
  const [data, setData] = useState([]);
  const [namaWarga, setNamaWarga] = useState('');
  const [editId, setEditId] = useState(null);
  const [loading, setLoading] = useState(false);

  // Fetch semua data
  const fetchData = () => {
    setLoading(true);
    fetch(API_URL)
      .then(res => res.json())
      .then(json => setData(json))
      .catch(err => alert('Gagal fetch data: ' + err))
      .finally(() => setLoading(false));
  };

  useEffect(() => {
    fetchData();
  }, []);

  // Submit tambah atau update
  const handleSubmit = (e) => {
    e.preventDefault();
    if (!namaWarga.trim()) {
      alert('Nama Warga harus diisi');
      return;
    }

    if (editId) {
      // Update
      fetch(`${API_URL}/${editId}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ Nama_Warga: namaWarga })
      })
      .then(res => res.json())
      .then(() => {
        alert('Data berhasil diperbarui');
        setNamaWarga('');
        setEditId(null);
        fetchData();
      })
      .catch(err => alert('Gagal update: ' + err));
    } else {
      // Create
      fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ Nama_Warga: namaWarga })
      })
      .then(res => res.json())
      .then(() => {
        alert('Data berhasil ditambahkan');
        setNamaWarga('');
        fetchData();
      })
      .catch(err => alert('Gagal tambah data: ' + err));
    }
  };

  // Edit mode
  const handleEdit = (item) => {
    setEditId(item.ID);
    setNamaWarga(item.Nama_Warga);
  };

  // Delete
  const handleDelete = (id) => {
    if (!confirm('Yakin ingin menghapus data ini?')) return;
    fetch(`${API_URL}/${id}`, { method: 'DELETE' })
      .then(res => {
        if (res.status === 204) {
          alert('Data berhasil dihapus');
          fetchData();
        } else {
          alert('Gagal hapus data');
        }
      })
      .catch(err => alert('Gagal hapus: ' + err));
  };

  // Cancel edit
  const handleCancel = () => {
    setEditId(null);
    setNamaWarga('');
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <label>Nama Warga:</label>
        <input
          type="text"
          value={namaWarga}
          onChange={e => setNamaWarga(e.target.value)}
          required
        />
        <button type="submit">{editId ? 'Update' : 'Tambah'}</button>
        {editId && <button type="button" onClick={handleCancel} style={{marginLeft:'10px'}}>Batal</button>}
      </form>

      {loading ? <p>Loading data...</p> : (
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nama Warga</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody>
            {data.length === 0 && <tr><td colSpan="3">Data kosong</td></tr>}
            {data.map(item => (
              <tr key={item.ID}>
                <td>{item.ID}</td>
                <td>{item.Nama_Warga}</td>
                <td>
                  <button className="btn-edit" onClick={() => handleEdit(item)}>Edit</button>{' '}
                  <button className="btn-delete" onClick={() => handleDelete(item.ID)}>Hapus</button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      )}
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);

</script>

</body>
</html>
